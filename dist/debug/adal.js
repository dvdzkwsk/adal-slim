function e(){return(e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function n(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return r(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,void 0):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}var t,o,a,i;!function(e){e.LOGIN="LOGIN",e.RENEW_TOKEN="RENEW_TOKEN",e.UNKNOWN="UNKNOWN"}(o||(o={})),function(e){e.ID_TOKEN="id_token token",e.TOKEN="token"}(a||(a={})),function(e){e.Canceled="Canceled",e.Completed="Completed",e.InProgress="In Progress"}(i||(i={}));var s,c=function(e){return encodeURIComponent(e)},l=function(e,r){return new RegExp("[\\?&]"+e+"=").test(r)},u=function(e,r){return e.replace(new RegExp("(\\&"+r+"=)[^&]+"),"").replace(new RegExp("("+r+"=)[^&]+&"),"").replace(new RegExp("("+r+"=)[^&]+"),"")},d=function(e,r,n){if(void 0===n&&(n=!1),n){var t=R(e)||"";N.setItem(e,t+r+"||")}else N.setItem(e,r)},p=function(e){var r=R(s.TOKEN_KEYS);return!v(r)&&r.indexOf(e+"|")>-1},f=function(e){return e.indexOf("#/")>-1?e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1?e.substring(1):e},E=function(e){for(var r=/\+/g,n=/([^&=]+)=([^&]*)/g,t=function(e){return decodeURIComponent(e.replace(r," "))},o={},a=n.exec(e);a;)o[t(a[1])]=t(a[2]),a=n.exec(e);return o},_=function(){var e=new Uint8Array(16);return crypto.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,(e=e.map(function(e){for(var r=e.toString(16);r.length<2;)r="0"+r;return r}))[0]+e[1]+e[2]+e[3]+"-"+e[4]+e[5]+"-"+e[6]+e[7]+"-"+e[8]+e[9]+"-"+e[10]+e[11]+e[12]+e[13]+e[14]+e[15]},R=function(e){return N.getItem(e)},v=function(e){return!e||!e.length},I=function(e,r){return Object.hasOwnProperty.call(e,r)},O=function(){return Math.round(Date.now()/1e3)};!function(e){e.TOKEN_KEYS="adal.token.keys",e.ACCESS_TOKEN_KEY="adal.access.token.key",e.EXPIRATION_KEY="adal.expiration.key",e.STATE_LOGIN="adal.state.login",e.STATE_RENEW="adal.state.renew",e.NONCE_IDTOKEN="adal.nonce.idtoken",e.SESSION_STATE="adal.session.state",e.USERNAME="adal.username",e.IDTOKEN="adal.idtoken",e.ERROR="adal.error",e.ERROR_DESCRIPTION="adal.error.description",e.LOGIN_REQUEST="adal.login.request",e.LOGIN_ERROR="adal.login.error",e.RENEW_STATUS="adal.token.renew.status"}(s||(s={}));var g,N=function(){function e(e){var r=window[e];return!!r&&(r.setItem("__test__","__test__"),"__test__"===r.getItem("__test__")&&(r.removeItem("__test__"),!r.getItem("__test__")))}return e("localStorage")?localStorage:e("sessionStorage")?sessionStorage:{getItem:function(){},setItem:function(){}}}();(g=exports.LogLevel||(exports.LogLevel={}))[g.Error=0]="Error",g[g.Warn=1]="Warn",g[g.Info=2]="Info",g[g.Verbose=3]="Verbose";var T=((t={})[exports.LogLevel.Error]="ERROR",t[exports.LogLevel.Warn]="WARNING",t[exports.LogLevel.Info]="INFO",t[exports.LogLevel.Verbose]="VERBOSE",t),m={pii:!1,correlationId:void 0,level:exports.LogLevel.Error,log:function(e,r,n,t){if(void 0===t&&(t=!1),(!t||this.pii)&&e<=this.level){var o=(new Date).toUTCString()+":"+(this.correlationId?this.correlationId+"-":"")+T[e]+": "+r;n&&(o+="\nstack:\n"+n.stack),console.log(o)}},error:function(e,r){this.log(exports.LogLevel.Error,e,r)},warn:function(e){this.log(exports.LogLevel.Warn,e,null)},info:function(e){this.log(exports.LogLevel.Info,e,null)},verbose:function(e){this.log(exports.LogLevel.Verbose,e,null)},errorPii:function(e,r){this.log(exports.LogLevel.Error,e,r,!0)},warnPii:function(e){this.log(exports.LogLevel.Warn,e,null,!0)},infoPii:function(e){this.log(exports.LogLevel.Info,e,null,!0)},verbosePii:function(e){this.log(exports.LogLevel.Verbose,e,null,!0)}};exports.AuthenticationContext=function(r){if(window._adalInstance)return window._adalInstance;var t,g;r=function(r){return r=e({popUp:!1,instance:"https://login.microsoftonline.com/",loginResource:r.clientId,laodFrameTimeout:6e3,expireOffsetSeconds:300,navigateToLoginRequestUrl:!0,tenant:"common",redirectUri:window.location.href.split("?")[0].split("#")[0],callback:function(){}},r),m.correlationId=r.correlationId,r}(r);var N={},T=!1,w=!1,h=[],S=[],k={},b={},L=o.LOGIN;function K(e,r,n,t,o){m.warn(t),d(s.ERROR,n),d(s.ERROR_DESCRIPTION,t),d(s.LOGIN_ERROR,o),r&&N[r]&&(N[r]=null),T=!1,w=!1,e&&e(t,null,n)}function y(e,n,t){var o=function(e,r,n,t){try{var o=window.innerWidth/2-241.5+window.screenX,a=window.innerHeight/2-300+window.screenY,i=window.open(e,"login","width=483, height=600, top="+a+", left="+o);return i.focus&&i.focus(),i}catch(e){m.warn("Error opening popup, "+e.message),T=!1,w=!1}}(e),a=t||r.callback;if(o){S.push(o);var i=r.redirectUri.split("#")[0],s=setInterval(function(){if(!o||o.closed||void 0===o.closed){var e="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return K(a,n,"Popup Window closed",e,e),void clearInterval(s)}try{var r=o.location;if(-1!=encodeURI(r.href).indexOf(encodeURI(i)))return D(r.hash),clearInterval(s),T=!1,w=!1,m.info("Closing popup window"),S=[],void o.close()}catch(e){}},1)}else{var c="Popup Window is null. This can happen if you are using IE";K(a,n,"Error opening popup",c,c)}}function C(e,r,n){N[r]=e,b[e]||(b[e]=[]),b[e].push(n),k[e]||(k[e]=function(n,t,o,a){N[r]=null;for(var i=0;i<b[e].length;++i)try{b[e][i](n,t,o,a)}catch(o){m.warn(o)}b[e]=null,k[e]=null})}function x(e,n,t){void 0===t&&(t="token"),m.info("renewToken is called for resource:"+e);var o=Y("adalRenewFrame"+e),i=_()+"|"+e;r.state=i,h.push(i),m.verbose("Renew token Expected state: "+i);var l=u(G(t,e),"prompt");t===a.ID_TOKEN&&(g=_(),d(s.NONCE_IDTOKEN,g,!0),l+="&nonce="+c(g)),l=W(l+="&prompt=none"),C(i,e,n),m.verbosePii("Navigate to:"+l),o.src="about:blank",P(l,"adalRenewFrame"+e,e)}function A(e,n){var t=Y("adalIdTokenFrame"),o=_()+"|"+r.clientId;g=_(),d(s.NONCE_IDTOKEN,g,!0),r.state=o,h.push(o),m.verbose("Renew Idtoken Expected state: "+o);var a=n||r.clientId,i=u(G(n=n||"id_token",a),"prompt");i=W(i+"&prompt=none"),i+="&nonce="+c(g),C(o,r.clientId,e),m.verbosePii("Navigate to:"+i),t.src="about:blank",P(i,"adalIdTokenFrame",r.clientId)}function P(e,n,t){m.verbose("Set loading state to pending for: "+t),d(s.RENEW_STATUS+t,i.InProgress),function e(r,n){m.info("LoadFrame: "+n),setTimeout(function(){var t=Y(n);t.src&&"about:blank"!==t.src||(t.src=r,e(r,n))},500)}(e,n),setTimeout(function(){if(R(s.RENEW_STATUS+t)===i.InProgress){m.verbose("Loading frame has timed out after: "+r.loadFrameTimeout/1e3+" seconds for resource "+t);var e=N[t];e&&k[e]&&k[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),d(s.RENEW_STATUS+t,i.Canceled)}},r.loadFrameTimeout)}function U(e){e?(m.infoPii("Navigate to:"+e),window.location.replace(e)):m.info("Navigate url is empty")}function W(e){if(!t||!t.profile)return e;if(t.profile.sid&&-1!==e.indexOf("&prompt=none"))l("sid",e)||(e+="&sid="+c(t.profile.sid));else if(t.profile.upn&&(l("login_hint",e)||(e+="&login_hint="+c(t.profile.upn)),!l("domain_hint",e)&&t.profile.upn.indexOf("@")>-1)){var r=t.profile.upn.split("@");e+="&domain_hint="+c(r[r.length-1])}return e}function q(e){var n=function(e){var r,n=function(e){if(!v(e)){var r=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(r&&!(r.length<4))return{header:r[1],JWSPayload:r[2],JWSSig:r[3]};m.warn("The returned id_token is not parseable.")}}(e);if(n)try{var t=(r=(r=n.JWSPayload).replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(r))));return t?JSON.parse(t):void m.info("The returned id_token could not be base64 url safe decoded.")}catch(e){m.error("The returned id_token could not be decoded",e)}}(e);if(I(n,"aud"))return n.aud.toLowerCase()===r.clientId.toLowerCase()?{userName:n.upn||n.email,profile:n}:void m.warn("IdToken has invalid aud field")}function D(e){if(void 0===e&&(e=window.location.hash),function(e){var r=E(f(e));return I(r,"error_description")||I(r,"access_token")||I(r,"id_token")}(e)){var r,n,t=S[S.length-1];t&&t.opener&&t.opener._AuthenticationContextInstance?(r=t.opener._adalInstance,n=!0):window.parent&&window.parent._adalInstance&&(r=window.parent._adalInstance);var a,i,c,l=r.getRequestInfo(e);a=n||window.parent!==window?r._callBackMappedToRenewStates[l.stateResponse]:r.config.callback,r.saveTokenFromHash(l),l.requestType===o.RENEW_TOKEN&&window.parent?(window.parent!==window?m.verbose("Window is in iframe, acquiring token silently"):m.verbose("acquiring token interactive in progress"),i=l.parameters.access_token||l.parameters.id_token,c="access_token"):l.requestType===o.LOGIN&&(i=l.parameters.id_token,c="id_token");try{a&&a(l.parameters.error_description,i,l.parameters.error,c)}catch(e){m.error("Error occurred in user defined callback function: "+e)}window.parent!==window||n||(r.config.navigateToLoginRequestUrl?window.location.href=R(s.LOGIN_REQUEST):window.location.hash="")}}var G=function(e,n){return r.instance+r.tenant+"/oauth2/authorize"+function(e,r,n){if(!r)return"";var t=["?response_type="+e,"client_id="+c(r.clientId)];n&&t.push("resource="+c(n)),t.push("redirect_uri="+c(r.redirectUri)),t.push("state="+c(r.state)),I(r,"slice")&&t.push("slice="+c(r.slice)),I(r,"extraQueryParameter")&&t.push(r.extraQueryParameter);var o=r.correlationId||_();return t.push("client-request-id="+c(o)),t.join("&")}(e,r,n)};function Y(e){return document.getElementById(e)||(m.info("Add adal frame to document:"+e),document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>'),window.frames&&window.frames[e])}return window._adalInstance={config:r,login:function(){if(T)m.info("Login in progress");else{T=!0;var e=_(),n=window.location.href;r.state=e,g=_(),m.verbose("Expected state: "+e+" startPage:"+n),d(s.LOGIN_REQUEST,n),d(s.LOGIN_ERROR,""),d(s.STATE_LOGIN,e,!0),d(s.NONCE_IDTOKEN,g,!0),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,"");var t=G("id_token")+"&nonce="+c(g);r.displayCall?r.displayCall(t):r.popUp?(d(s.STATE_LOGIN,""),h.push(e),C(e,r.clientId,r.callback),y(t)):U(t)}},logout:function(){var e;if(function(){d(s.LOGIN_REQUEST,""),d(s.SESSION_STATE,""),d(s.STATE_LOGIN,""),d(s.STATE_RENEW,""),h=[],d(s.NONCE_IDTOKEN,""),d(s.IDTOKEN,""),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,""),d(s.LOGIN_ERROR,""),d(s.LOGIN_ERROR,"");var e=R(s.TOKEN_KEYS);if(!v(e)){e=e.split("|");for(var r=0;r<e.length&&""!==e[r];r++)d(s.ACCESS_TOKEN_KEY+e[r],""),d(s.EXPIRATION_KEY+e[r],0)}d(s.TOKEN_KEYS,"")}(),t=null,r.logOutUri)e=r.logOutUri;else{var n="";r.postLogoutRedirectUri&&(n="post_logout_redirect_uri="+c(r.postLogoutRedirectUri)),e=r.instance+r.tenant+"/oauth2/logout?"+n}m.infoPii("Logout navigate to: "+e),U(e)},getUser:function(){if(!t){var e=R(s.IDTOKEN);e&&(t=q(e))}return t},registerCallback:C,acquireToken:function(e,n){if(!e){var i="resource is required";return m.warn(i),void n(i,null,i)}var c=function(e){if(p(e)){var n=R(s.ACCESS_TOKEN_KEY+e),t=R(s.EXPIRATION_KEY+e);if(t&&t>O()+r.expireOffsetSeconds)return n;d(s.ACCESS_TOKEN_KEY+e,""),d(s.EXPIRATION_KEY+e,0)}}(e);if(c)return m.info("Token is already in cache for resource:"+e),void n(null,c,null);if(!(t||r.extraQueryParameter&&-1!==r.extraQueryParameter.indexOf("login_hint"))){var l="User login is required";return m.warn(l),void n(l,null,l)}N[e]?C(N[e],e,n):(L=o.RENEW_TOKEN,e===r.clientId?t?(m.verbose("renewing idtoken"),A(n)):(m.verbose("renewing idtoken and access_token"),A(n,a.ID_TOKEN)):t?(m.verbose("renewing access_token"),x(e,n)):(m.verbose("renewing idtoken and access_token"),x(e,n,a.ID_TOKEN)))},acquireTokenPopup:function(e,n,a,i){if(function(e){var n;return e?t?w&&(n="Acquire token interactive is already in progress"):n="User login is required":n="Resource is required",n&&(m.warn(n),r.callback(n,null,n)),!n}(e)){var s=_()+"|"+e;r.state=s,h.push(s),L=o.RENEW_TOKEN,m.verbose("Renew token Expected state: "+s);var l=u(G("token",e),"prompt");if(l+="&prompt=select_account",n&&(l+=n),a){if(-1!==l.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");l+="&claims="+c(a)}l=W(l),w=!0,m.info("acquireToken interactive is called for the resource "+e),C(s,e,i),y(l,e,i)}},getRequestInfo:function(e){var r={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:o.UNKNOWN},t=E(f(e));if(!t)return r;if(r.parameters=t,I(t,"error_description")||I(t,"access_token")||I(t,"id_token")){if(r.valid=!0,!I(t,"state"))return m.warn("No state returned"),r;if(m.verbose("State: "+t.state),r.stateResponse=t.state,function(e){var r=R(s.STATE_LOGIN);if(r)for(var t,a=n(r.split("||"));!(t=a()).done;)if(t.value===e.stateResponse)return e.requestType=o.LOGIN,e.stateMatch=!0,!0;var i=R(s.STATE_RENEW);if(i)for(var c,l=n(i.split("||"));!(c=l()).done;)if(c.value===e.stateResponse)return e.requestType=o.RENEW_TOKEN,e.stateMatch=!0,!0;return!1}(r))return r;if(!r.stateMatch&&window.parent){r.requestType=L;for(var a,i=n(h);!(a=i()).done;)if(a.value===r.stateResponse){r.stateMatch=!0;break}}}return r},saveTokenFromHash:function(e){m.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,"");var a,c=function(e){if(e){var r=e.indexOf("|");if(r>-1&&r+1<e.length)return e.substring(r+1)}return""}(e.stateResponse);if(I(e.parameters,"error_description"))m.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters.error_description),d(s.ERROR,e.parameters.error),d(s.ERROR_DESCRIPTION,e.parameters.error_description),e.requestType===o.LOGIN&&(T=!1,d(s.LOGIN_ERROR,e.parameters.error_description));else if(e.stateMatch){var l;if(m.info("State is right"),I(e.parameters,"session_state")&&d(s.SESSION_STATE,e.parameters.session_state),I(e.parameters,"access_token")&&(m.info("Fragment has access token"),p(c)||(l=R(s.TOKEN_KEYS)||"",d(s.TOKEN_KEYS,l+c+"|")),d(s.ACCESS_TOKEN_KEY+c,e.parameters.access_token),d(s.EXPIRATION_KEY+c,((a=e.parameters.expires_in)||(a=3599),O()+parseInt(a,10)))),I(e.parameters,"id_token"))if(T=!1,(t=q(e.parameters.id_token))&&t.profile)!function(e){var r=R(s.NONCE_IDTOKEN);if(r)for(var t,o=n(r.split("||"));!(t=o()).done;)if(t.value===e.profile.nonce)return!0;return!1}(t)?(d(s.LOGIN_ERROR,"Nonce received: "+t.profile.nonce+" is not same as requested: "+R(s.NONCE_IDTOKEN)),t=null):(d(s.IDTOKEN,e.parameters.id_token),p(c=r.loginResource?r.loginResource:r.clientId)||(l=R(s.TOKEN_KEYS)||"",d(s.TOKEN_KEYS,l+c+"|")),d(s.ACCESS_TOKEN_KEY+c,e.parameters.id_token),d(s.EXPIRATION_KEY+c,t.profile.exp));else{var u="invalid id_token",f="Invalid id_token. id_token: "+e.parameters.id_token;e.parameters.error=u,e.parameters.error_description=f,d(s.ERROR,u),d(s.ERROR_DESCRIPTION,f)}}else{var E="Invalid_state. state: "+e.stateResponse;e.parameters.error="Invalid_state",e.parameters.error_description=E,d(s.ERROR,"Invalid_state"),d(s.ERROR_DESCRIPTION,E)}d(s.RENEW_STATUS+c,i.Completed)},loginInProgress:function(){return T},handleWindowCallback:D,_callBackMappedToRenewStates:k,_callBacksMappedToRenewStates:b}},exports.clearCacheForResource=function(e){d(s.STATE_RENEW,""),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,""),p(e)&&(d(s.ACCESS_TOKEN_KEY+e,""),d(s.EXPIRATION_KEY+e,0))};
//# sourceMappingURL=adal.js.map
