function e(){return(e=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function r(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return n(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}var t,o,a,i;!function(e){e.LOGIN="LOGIN",e.RENEW_TOKEN="RENEW_TOKEN",e.UNKNOWN="UNKNOWN"}(o||(o={})),function(e){e.ID_TOKEN="id_token token",e.TOKEN="token"}(a||(a={})),function(e){e.Canceled="Canceled",e.Completed="Completed",e.InProgress="In Progress"}(i||(i={}));var s,c=function(e){return encodeURIComponent(e)},l=function(e,n){return new RegExp("[\\?&]"+e+"=").test(n)},u=function(e,n){return e.replace(new RegExp("(\\&"+n+"=)[^&]+"),"").replace(new RegExp("("+n+"=)[^&]+&"),"").replace(new RegExp("("+n+"=)[^&]+"),"")},d=function(e,n,r){if(void 0===r&&(r=!1),r){var t=_(e)||"";v.setItem(e,t+n+"||")}else v.setItem(e,n)},p=function(e){var n=_(s.TOKEN_KEYS);return!O(n)&&n.indexOf(e+"|")>-1},E=function(e){return e.indexOf("#/")>-1?e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1?e.substring(1):e},f=function(e){for(var n=/\+/g,r=/([^&=]+)=([^&]*)/g,t=function(e){return decodeURIComponent(e.replace(n," "))},o={},a=r.exec(e);a;)o[t(a[1])]=t(a[2]),a=r.exec(e);return o},R=function(){var e=new Uint8Array(16);return crypto.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,(e=e.map(function(e){for(var n=e.toString(16);n.length<2;)n="0"+n;return n}))[0]+e[1]+e[2]+e[3]+"-"+e[4]+e[5]+"-"+e[6]+e[7]+"-"+e[8]+e[9]+"-"+e[10]+e[11]+e[12]+e[13]+e[14]+e[15]},_=function(e){return v.getItem(e)},O=function(e){return!e||!e.length},I=function(e,n){return Object.hasOwnProperty.call(e,n)},N=function(){return Math.round(Date.now()/1e3)};!function(e){e.TOKEN_KEYS="adal.token.keys",e.ACCESS_TOKEN_KEY="adal.access.token.key",e.EXPIRATION_KEY="adal.expiration.key",e.STATE_LOGIN="adal.state.login",e.STATE_RENEW="adal.state.renew",e.NONCE_IDTOKEN="adal.nonce.idtoken",e.SESSION_STATE="adal.session.state",e.USERNAME="adal.username",e.IDTOKEN="adal.idtoken",e.ERROR="adal.error",e.ERROR_DESCRIPTION="adal.error.description",e.LOGIN_REQUEST="adal.login.request",e.LOGIN_ERROR="adal.login.error",e.RENEW_STATUS="adal.token.renew.status"}(s||(s={}));var T,v=function(){function e(e){var n=window[e];if(!n)return!1;var r="__test__";return n.setItem(r,r),n.getItem(r)===r&&(n.removeItem(r),!n.getItem(r))}return e("localStorage")?localStorage:e("sessionStorage")?sessionStorage:{getItem:function(){},setItem:function(){}}}();exports.LogLevel=void 0,(T=exports.LogLevel||(exports.LogLevel={}))[T.Error=0]="Error",T[T.Warn=1]="Warn",T[T.Info=2]="Info",T[T.Verbose=3]="Verbose",(t={})[exports.LogLevel.Error]="ERROR",t[exports.LogLevel.Warn]="WARNING",t[exports.LogLevel.Info]="INFO",t[exports.LogLevel.Verbose]="VERBOSE",exports,exports.AuthenticationContext=function(n){if(window._adalInstance)return window._adalInstance;var t,T;n=function(n){return e({popUp:!1,instance:"https://login.microsoftonline.com/",loginResource:n.clientId,laodFrameTimeout:6e3,expireOffsetSeconds:300,navigateToLoginRequestUrl:!0,tenant:"common",redirectUri:window.location.href.split("?")[0].split("#")[0],callback:function(){}},n)}(n);var v={},m=!1,g=!1,S=[],w=[],h={},K={},k=o.LOGIN;function y(e,n,r,t,o){d(s.ERROR,r),d(s.ERROR_DESCRIPTION,t),d(s.LOGIN_ERROR,o),n&&v[n]&&(v[n]=null),m=!1,g=!1,e&&e(t,null,r)}function C(e,r,t){var o=function(e,n,r,t){try{var o=window.innerWidth/2-241.5+window.screenX,a=window.innerHeight/2-300+window.screenY,i=window.open(e,"login","width=483, height=600, top="+a+", left="+o);return i.focus&&i.focus(),i}catch(e){m=!1,g=!1}}(e),a=t||n.callback;if(o){w.push(o);var i=n.redirectUri.split("#")[0],s=setInterval(function(){if(!o||o.closed||void 0===o.closed){var e="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return y(a,r,"Popup Window closed",e,e),void clearInterval(s)}try{var n=o.location;if(-1!=encodeURI(n.href).indexOf(encodeURI(i)))return G(n.hash),clearInterval(s),m=!1,g=!1,w=[],void o.close()}catch(e){}},1)}else{var c="Popup Window is null. This can happen if you are using IE";y(a,r,"Error opening popup",c,c)}}function A(e,n,r){v[n]=e,K[e]||(K[e]=[]),K[e].push(r),h[e]||(h[e]=function(r,t,o,a){v[n]=null;for(var i=0;i<K[e].length;++i)try{K[e][i](r,t,o,a)}catch(o){}K[e]=null,h[e]=null})}function L(e,r,t){void 0===t&&(t="token");var o=q("adalRenewFrame"+e),i=R()+"|"+e;n.state=i,S.push(i);var l=u(Y(t,e),"prompt");t===a.ID_TOKEN&&(T=R(),d(s.NONCE_IDTOKEN,T,!0),l+="&nonce="+c(T)),l=W(l+="&prompt=none"),A(i,e,r),o.src="about:blank",x(l,"adalRenewFrame"+e,e)}function b(e,r){var t=q("adalIdTokenFrame"),o=R()+"|"+n.clientId;T=R(),d(s.NONCE_IDTOKEN,T,!0),n.state=o,S.push(o);var a=r||n.clientId,i=u(Y(r=r||"id_token",a),"prompt");i=W(i+"&prompt=none"),i+="&nonce="+c(T),A(o,n.clientId,e),t.src="about:blank",x(i,"adalIdTokenFrame",n.clientId)}function x(e,r,t){d(s.RENEW_STATUS+t,i.InProgress),P(e,r),setTimeout(function(){if(_(s.RENEW_STATUS+t)===i.InProgress){var e=v[t];e&&h[e]&&h[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),d(s.RENEW_STATUS+t,i.Canceled)}},n.loadFrameTimeout)}function P(e,n){setTimeout(function(){var r=q(n);r.src&&"about:blank"!==r.src||(r.src=e,P(e,n))},500)}function U(e){e&&window.location.replace(e)}function W(e){if(!t||!t.profile)return e;if(t.profile.sid&&-1!==e.indexOf("&prompt=none"))l("sid",e)||(e+="&sid="+c(t.profile.sid));else if(t.profile.upn&&(l("login_hint",e)||(e+="&login_hint="+c(t.profile.upn)),!l("domain_hint",e)&&t.profile.upn.indexOf("@")>-1)){var n=t.profile.upn.split("@");e+="&domain_hint="+c(n[n.length-1])}return e}function D(e){var r=function(e){var n,r=function(e){if(!O(e)){var n=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(n&&!(n.length<4))return{header:n[1],JWSPayload:n[2],JWSSig:n[3]}}}(e);if(r)try{var t=(n=(n=r.JWSPayload).replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(n))));return t?JSON.parse(t):void 0}catch(e){}}(e);if(I(r,"aud"))return r.aud.toLowerCase()===n.clientId.toLowerCase()?{userName:r.upn||r.email,profile:r}:void 0}function G(e){if(void 0===e&&(e=window.location.hash),function(e){var n=f(E(e));return I(n,"error_description")||I(n,"access_token")||I(n,"id_token")}(e)){var n,r,t=w[w.length-1];t&&t.opener&&t.opener._AuthenticationContextInstance?(n=t.opener._adalInstance,r=!0):window.parent&&window.parent._adalInstance&&(n=window.parent._adalInstance);var a,i,c,l=n.getRequestInfo(e);a=r||window.parent!==window?n._callBackMappedToRenewStates[l.stateResponse]:n.config.callback,n.saveTokenFromHash(l),l.requestType===o.RENEW_TOKEN&&window.parent?(i=l.parameters.access_token||l.parameters.id_token,c="access_token"):l.requestType===o.LOGIN&&(i=l.parameters.id_token,c="id_token");try{a&&a(l.parameters.error_description,i,l.parameters.error,c)}catch(e){}window.parent!==window||r||(n.config.navigateToLoginRequestUrl?window.location.href=_(s.LOGIN_REQUEST):window.location.hash="")}}var Y=function(e,r){return n.instance+n.tenant+"/oauth2/authorize"+function(e,n,r){if(!n)return"";var t=["?response_type="+e,"client_id="+c(n.clientId)];r&&t.push("resource="+c(r)),t.push("redirect_uri="+c(n.redirectUri)),t.push("state="+c(n.state)),I(n,"slice")&&t.push("slice="+c(n.slice)),I(n,"extraQueryParameter")&&t.push(n.extraQueryParameter);var o=n.correlationId||R();return t.push("client-request-id="+c(o)),t.join("&")}(e,n,r)};function q(e){return document.getElementById(e)||(document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>'),window.frames&&window.frames[e])}return window._adalInstance={config:n,login:function(){if(!m){m=!0;var e=R(),r=window.location.href;n.state=e,T=R(),d(s.LOGIN_REQUEST,r),d(s.LOGIN_ERROR,""),d(s.STATE_LOGIN,e,!0),d(s.NONCE_IDTOKEN,T,!0),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,"");var t=Y("id_token")+"&nonce="+c(T);n.displayCall?n.displayCall(t):n.popUp?(d(s.STATE_LOGIN,""),S.push(e),A(e,n.clientId,n.callback),C(t)):U(t)}},logout:function(){var e;if(function(){d(s.LOGIN_REQUEST,""),d(s.SESSION_STATE,""),d(s.STATE_LOGIN,""),d(s.STATE_RENEW,""),S=[],d(s.NONCE_IDTOKEN,""),d(s.IDTOKEN,""),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,""),d(s.LOGIN_ERROR,""),d(s.LOGIN_ERROR,"");var e=_(s.TOKEN_KEYS);if(!O(e)){e=e.split("|");for(var n=0;n<e.length&&""!==e[n];n++)d(s.ACCESS_TOKEN_KEY+e[n],""),d(s.EXPIRATION_KEY+e[n],0)}d(s.TOKEN_KEYS,"")}(),t=null,n.logOutUri)e=n.logOutUri;else{var r="";n.postLogoutRedirectUri&&(r="post_logout_redirect_uri="+c(n.postLogoutRedirectUri)),e=n.instance+n.tenant+"/oauth2/logout?"+r}U(e)},getUser:function(){if(!t){var e=_(s.IDTOKEN);e&&(t=D(e))}return t},registerCallback:A,acquireToken:function(e,r){if(e){var i=function(e){if(p(e)){var r=_(s.ACCESS_TOKEN_KEY+e),t=_(s.EXPIRATION_KEY+e);if(t&&t>N()+n.expireOffsetSeconds)return r;d(s.ACCESS_TOKEN_KEY+e,""),d(s.EXPIRATION_KEY+e,0)}}(e);if(i)r(null,i,null);else if(t||n.extraQueryParameter&&-1!==n.extraQueryParameter.indexOf("login_hint"))v[e]?A(v[e],e,r):(k=o.RENEW_TOKEN,e===n.clientId?t?b(r):b(r,a.ID_TOKEN):t?L(e,r):L(e,r,a.ID_TOKEN));else{var c="User login is required";r(c,null,c)}}else{var l="resource is required";r(l,null,l)}},acquireTokenPopup:function(e,r,a,i){if(function(e){var r;return e?t?g&&(r="Acquire token interactive is already in progress"):r="User login is required":r="Resource is required",r&&n.callback(r,null,r),!r}(e)){var s=R()+"|"+e;n.state=s,S.push(s),k=o.RENEW_TOKEN;var l=u(Y("token",e),"prompt");if(l+="&prompt=select_account",r&&(l+=r),a){if(-1!==l.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");l+="&claims="+c(a)}l=W(l),g=!0,A(s,e,i),C(l,e,i)}},getRequestInfo:function(e){var n={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:o.UNKNOWN},t=f(E(e));if(!t)return n;if(n.parameters=t,I(t,"error_description")||I(t,"access_token")||I(t,"id_token")){if(n.valid=!0,!I(t,"state"))return n;if(n.stateResponse=t.state,function(e){var n=_(s.STATE_LOGIN);if(n)for(var t,a=r(n.split("||"));!(t=a()).done;)if(t.value===e.stateResponse)return e.requestType=o.LOGIN,e.stateMatch=!0,!0;var i=_(s.STATE_RENEW);if(i)for(var c,l=r(i.split("||"));!(c=l()).done;)if(c.value===e.stateResponse)return e.requestType=o.RENEW_TOKEN,e.stateMatch=!0,!0;return!1}(n))return n;if(!n.stateMatch&&window.parent){n.requestType=k;for(var a,i=r(S);!(a=i()).done;)if(a.value===n.stateResponse){n.stateMatch=!0;break}}}return n},saveTokenFromHash:function(e){d(s.ERROR,""),d(s.ERROR_DESCRIPTION,"");var a,c=function(e){if(e){var n=e.indexOf("|");if(n>-1&&n+1<e.length)return e.substring(n+1)}return""}(e.stateResponse);if(I(e.parameters,"error_description"))d(s.ERROR,e.parameters.error),d(s.ERROR_DESCRIPTION,e.parameters.error_description),e.requestType===o.LOGIN&&(m=!1,d(s.LOGIN_ERROR,e.parameters.error_description));else if(e.stateMatch){var l;if(I(e.parameters,"session_state")&&d(s.SESSION_STATE,e.parameters.session_state),I(e.parameters,"access_token")&&(p(c)||(l=_(s.TOKEN_KEYS)||"",d(s.TOKEN_KEYS,l+c+"|")),d(s.ACCESS_TOKEN_KEY+c,e.parameters.access_token),d(s.EXPIRATION_KEY+c,((a=e.parameters.expires_in)||(a=3599),N()+parseInt(a,10)))),I(e.parameters,"id_token"))if(m=!1,(t=D(e.parameters.id_token))&&t.profile)!function(e){var n=_(s.NONCE_IDTOKEN);if(n)for(var t,o=r(n.split("||"));!(t=o()).done;)if(t.value===e.profile.nonce)return!0;return!1}(t)?(d(s.LOGIN_ERROR,"Nonce received: "+t.profile.nonce+" is not same as requested: "+_(s.NONCE_IDTOKEN)),t=null):(d(s.IDTOKEN,e.parameters.id_token),p(c=n.loginResource?n.loginResource:n.clientId)||(l=_(s.TOKEN_KEYS)||"",d(s.TOKEN_KEYS,l+c+"|")),d(s.ACCESS_TOKEN_KEY+c,e.parameters.id_token),d(s.EXPIRATION_KEY+c,t.profile.exp));else{var u="invalid id_token",E="Invalid id_token. id_token: "+e.parameters.id_token;e.parameters.error=u,e.parameters.error_description=E,d(s.ERROR,u),d(s.ERROR_DESCRIPTION,E)}}else{var f="Invalid_state",R="Invalid_state. state: "+e.stateResponse;e.parameters.error=f,e.parameters.error_description=R,d(s.ERROR,f),d(s.ERROR_DESCRIPTION,R)}d(s.RENEW_STATUS+c,i.Completed)},loginInProgress:function(){return m},handleWindowCallback:G,_callBackMappedToRenewStates:h,_callBacksMappedToRenewStates:K}},exports.clearCacheForResource=function(e){d(s.STATE_RENEW,""),d(s.ERROR,""),d(s.ERROR_DESCRIPTION,""),p(e)&&(d(s.ACCESS_TOKEN_KEY+e,""),d(s.EXPIRATION_KEY+e,0))};
//# sourceMappingURL=adal.js.map
